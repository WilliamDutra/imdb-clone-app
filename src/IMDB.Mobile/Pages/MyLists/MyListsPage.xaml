<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="IMDB.Mobile.Pages.MyLists.MyListsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:cards="clr-namespace:IMDB.Mobile.Components.Cards"
    xmlns:language="clr-namespace:IMDB.Mobile.Resources"
    xmlns:model="clr-namespace:IMDB.ApiClient;assembly=IMDB.ApiClient"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:vm="clr-namespace:IMDB.Mobile.Pages.MyLists"
    x:Name="myListsPage"
    x:DataType="vm:MyListsPageViewModel"
    Shell.NavBarIsVisible="False">

    <ContentPage.Behaviors>
        <toolkit:AnimationBehavior
            BindingContext="{Binding Source={x:Reference myListsPage}, Path=BindingContext}"
            Command="{Binding InitializeCommand}"
            EventName="Loaded" />
    </ContentPage.Behaviors>

    <VerticalStackLayout Spacing="20">

        <Label>
            <Label.FormattedText>
                <FormattedString>
                    <Span
                        FontFamily="PoppinsBold"
                        FontSize="28"
                        Text="{x:Static language:Resource.title_mylists}"
                        TextColor="White" />
                    <Span
                        FontFamily="PoppinsBold"
                        FontSize="28"
                        TextColor="{StaticResource ColorSecondary}">
                        .
                    </Span>
                </FormattedString>
            </Label.FormattedText>
        </Label>

        <Grid ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <Border Background="{StaticResource ColorTertiary}" StrokeThickness="5">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="10" />
                </Border.StrokeShape>
                <Entry Grid.Column="0" Text="{Binding Name}" />
            </Border>
            <Button
                Grid.Column="1"
                Command="{Binding CreateListCommand}"
                Text="{Static language:Resource.button_create_mylists}" />
        </Grid>

        <CollectionView ItemsSource="{Binding Lists}" SelectionMode="None">
            <CollectionView.Triggers>
                <DataTrigger
                    Binding="{Binding IsBusy}"
                    TargetType="CollectionView"
                    Value="True">
                    <Setter Property="IsVisible" Value="False" />
                </DataTrigger>
            </CollectionView.Triggers>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="model:MyList">
                    <Grid>
                        <SwipeView>
                            <SwipeView.LeftItems>
                                <SwipeItems>
                                    <SwipeItemView>
                                        <VerticalStackLayout Padding="10" Background="{StaticResource ColorSecondary}">
                                            <Image Source="trash.png">
                                                <Image.Behaviors>
                                                    <toolkit:IconTintColorBehavior TintColor="{StaticResource White}" />
                                                </Image.Behaviors>
                                                <Image.GestureRecognizers>
                                                    <TapGestureRecognizer Command="{Binding Source={x:RelativeSource AncestorType={x:Type vm:MyListsPageViewModel}}, Path=DeleteCommand}" CommandParameter="{Binding Id}" />
                                                </Image.GestureRecognizers>
                                            </Image>
                                        </VerticalStackLayout>
                                    </SwipeItemView>
                                </SwipeItems>
                            </SwipeView.LeftItems>
                            <VerticalStackLayout Padding="0,10">
                                <Label
                                    Margin="10,0,0,0"
                                    FontFamily="PoppinsRegular"
                                    FontSize="18"
                                    Text="{Binding Name}"
                                    VerticalOptions="Center" />
                                <VerticalStackLayout.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={x:RelativeSource AncestorType={x:Type vm:MyListsPageViewModel}}, Path=DetailCommand}" CommandParameter="{Binding .}" />
                                </VerticalStackLayout.GestureRecognizers>
                            </VerticalStackLayout>
                        </SwipeView>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <CollectionView ItemsSource="{Binding FakeLists}">
            <CollectionView.Triggers>
                <DataTrigger
                    Binding="{Binding IsBusy}"
                    TargetType="CollectionView"
                    Value="False">
                    <Setter Property="IsVisible" Value="False" />
                </DataTrigger>
            </CollectionView.Triggers>
            <CollectionView.ItemsLayout>
                <LinearItemsLayout ItemSpacing="10" Orientation="Vertical" />
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <BoxView BackgroundColor="Gray" HeightRequest="60" />
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>


    </VerticalStackLayout>
</ContentPage>